{"version":3,"sources":["webpack:///webpack/bootstrap 1f46bf8ac1e7d9ae496f","webpack:///./app/api/user.js","webpack:///./src/index.js","webpack:///external \"koa\"","webpack:///external \"path\"","webpack:///external \"fs\"","webpack:///./app/api ^\\.\\/.*$","webpack:///./index.js","webpack:///./src/restgen.js","webpack:///external \"koa-router\"","webpack:///external \"koa-body\""],"names":["User","constructor","get","ctx","body","Koa","app","normalizedPath","require","join","__dirname","readdirSync","forEach","file","Cls","default","cls","use","generate","listen","module","exports","rest","router","prefix","multipart","destruct","args","hasPath","path","middleware","slice","some","m","Error","route","method","target","name","RestGen","model","find","models","exec","success","data","error","findOne","id","params","findById","create","request","update","result","_id","remove","deleteOne","self","bind","post","put","delete","list","Object","getOwnPropertyNames","getPrototypeOf","filter","f","map","fun","routes","includes"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1f46bf8ac1e7d9ae496f","import { RestGen, route } from '../../index'\r\n\r\nclass User extends RestGen {\r\n  constructor () {\r\n    super('user')\r\n  }\r\n  @route('get', 'some')\r\n  async get (ctx) {\r\n    ctx.body = 'hello world'\r\n  }\r\n}\r\n\r\nexport default User\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./app/api/user.js","const Koa = require('koa')\r\n// const glob = require('glob')\r\n\r\nconst app = new Koa()\r\n// var appRoot = require('path').resolve(process.cwd())\r\n// let routes = []\r\nconst normalizedPath = require('path').join(__dirname, '../app/api')\r\nrequire('fs').readdirSync(normalizedPath).forEach(function (file) {\r\n  var Cls = require(`../app/api/${file}`).default\r\n  var cls = new Cls()\r\n  app.use(cls.generate())\r\n})\r\n\r\n// const app = (app) => {\r\n//   routes.forEach(route => {\r\n//     app.use(route)\r\n//   })\r\n// }\r\napp.listen(2000)\r\nmodule.exports = app\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 5\n// module chunks = 0","var map = {\n\t\"./user\": 0,\n\t\"./user.js\": 0\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number or string\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./app/api ^\\.\\/.*$\n// module id = 6\n// module chunks = 0","\r\nconst rest = require('./src/restgen')\r\n\r\nmodule.exports = rest\r\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","const router = require('koa-router')({\r\n  prefix: '/api'\r\n})\r\nconst body = require('koa-body')({ multipart: true })\r\n\r\nfunction destruct (args) {\r\n  const hasPath = typeof args[0] === 'string'\r\n  const path = hasPath ? args[0] : ''\r\n  const middleware = hasPath ? args.slice(1) : args\r\n\r\n  if (middleware.some(m => typeof m !== 'function')) {\r\n    throw new Error('Middleware must be function')\r\n  }\r\n\r\n  return [path, middleware]\r\n}\r\n\r\n// @route(method, path: optional, ...middleware: optional)\r\nfunction route (method, ...args) {\r\n  if (typeof method !== 'string') {\r\n    throw new Error('The first argument must be an HTTP method')\r\n  }\r\n\r\n  const [path] = destruct(args)\r\n\r\n  return function (target, name) {\r\n    if (!target['routes']) {\r\n      target['routes'] = {}\r\n    }\r\n    target['routes'][name] = { method, path }\r\n  }\r\n}\r\nclass RestGen {\r\n  constructor (path, model) {\r\n    this.path = path\r\n    this.model = model\r\n  }\r\n  async find (ctx) {\r\n    try {\r\n      const models = await this.model.find().exec()\r\n      ctx.body = { success: true, data: models }\r\n    } catch (error) {\r\n      ctx.body = { success: false, error }\r\n    }\r\n  }\r\n  async findOne (ctx) {\r\n    try {\r\n      const id = ctx.params.id\r\n      const model = await this.model.findById(id).exec()\r\n      ctx.body = { success: true, data: model }\r\n    } catch (error) {\r\n      ctx.body = { success: false, error }\r\n    }\r\n  }\r\n  async create (ctx) {\r\n    try {\r\n      const body = ctx.request.body\r\n      const model = await this.model.create(body)\r\n      ctx.body = { success: true, data: model }\r\n    } catch (error) {\r\n      ctx.body = { success: false, error }\r\n    }\r\n  }\r\n  async update (ctx) {\r\n    try {\r\n      const id = ctx.params.id\r\n      const body = ctx.request.body\r\n      const result = await this.model.update({ _id: id }, body)\r\n      ctx.body = { success: true, data: result }\r\n    } catch (error) {\r\n      ctx.body = { success: false, error }\r\n    }\r\n  }\r\n  async remove (ctx) {\r\n    try {\r\n      const id = ctx.params.id\r\n      const result = await this.model.deleteOne({ _id: id })\r\n      ctx.body = { success: true, data: result }\r\n    } catch (error) {\r\n      ctx.body = { success: false, error }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate Route for Class\r\n   */\r\n  generate () {\r\n    var self = this\r\n    if (this.model) {\r\n      router.get(`/${this.path}`, this.find.bind(this))\r\n      router.get(`/${this.path}/:id`, this.findOne.bind(this))\r\n      router.post(`/${this.path}`, body, this.create.bind(this))\r\n      router.put(`/${this.path}/:id`, body, this.update.bind(this))\r\n      router.delete(`/${this.path}/:id`, this.remove.bind(this))\r\n    }\r\n    let list = Object.getOwnPropertyNames(Object.getPrototypeOf(this)).filter(f => {\r\n      if (typeof (self[f]) === 'function') {\r\n        return f\r\n      }\r\n    }).map(f => f)\r\n    list.forEach((fun) => {\r\n      switch (fun) {\r\n        case 'constructor':\r\n        case 'route':\r\n          break\r\n        case 'find':\r\n          router[fun](`/${this.path}`, this[fun].bind(this))\r\n          break\r\n        case 'post':\r\n        case 'put':\r\n        case 'patch':\r\n        case 'delete':\r\n          router[fun](`/${this.path}`, body, this[fun].bind(this))\r\n          break\r\n        default:\r\n          let route = this.routes && this.routes[fun] ? this.routes[fun] : {\r\n            method: fun.includes('post') ? 'post' : fun.includes('put') ? 'put' : 'get',\r\n            path: fun\r\n          }\r\n          route.path = `/${this.path}/${route.path}`\r\n          switch (route.method) {\r\n            case 'post':\r\n            case 'put':\r\n            case 'patch':\r\n            case 'delete':\r\n              router[route.method](`${route.path}`, body, this[fun].bind(this))\r\n              break\r\n            default:\r\n              router.get(`${route.path}`, this[fun].bind(this))\r\n              break\r\n          }\r\n          break\r\n      }\r\n    })\r\n    return router.routes()\r\n  }\r\n}\r\n\r\nmodule.exports = { route, RestGen }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/restgen.js","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"koa-body\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-body\"\n// module id = 10\n// module chunks = 0"],"sourceRoot":""}